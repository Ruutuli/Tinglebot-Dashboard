/* Import fantasy font */
/* @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap'); */

/* ============================================================================ */
/* Zelda/BOTW Color Variables for Map */
/* ============================================================================ */
:root {
    /* BOTW-Inspired Theme Colors */
    --botw-blue:            #00A3DA;
    --botw-dark-blue:       #0169A0;
    --botw-darkest-blue:    #275880;
    --botw-warm-black:      #302826;
    --botw-black:           #170606;
    --botw-full-black:      #000000;
    --botw-pale:            #d6cecd;
    --botw-beige:           #B99F65;
    --botw-dark-beige:      #87733C;
    --botw-icon-beige:      #AF966D;
    --botw-white:           #FFFFFF;
    
    /* Default Dark Mode Colors */
    --bg-primary:           #1A1A1A;
    --bg-secondary:         #2D2D2D;
    --bg-tertiary:          #404040;
    --text-primary:         #FFFFFF;
    --text-secondary:       #B3B3B3;
    --text-muted:           #808080;
    --border-color:         #404040;
    --border-light:         #2D2D2D;
    --accent-color:         #00A3DA;
    --accent-hover:         #0169A0;
    --success-color:        #28A745;
    --warning-color:        #FFC107;
    --danger-color:         #DC3545;
    --error-color:          #DC3545;
    --info-color:           #17A2B8;
    
    /* Glass Morphism Effects */
    --glass-bg:             rgba(32, 36, 44, 0.72);
    --glass-border:         rgba(255,255,255,0.08);
    --glass-divider:        rgba(255,255,255,0.06);
    
    /* Shadows */
    --shadow:               rgba(0, 0, 0, 0.3);
    --shadow-hover:         rgba(0, 0, 0, 0.4);
    --card-shadow:          0 4px 24px rgba(0,0,0,0.13);
    --section-shadow:       0 4px 24px rgba(0,0,0,0.13);
    --section-glow:         0 8px 32px 0 rgba(0,163,218,0.18), 0 1.5px 8px 0 rgba(0,0,0,0.10);
    
    /* Blur Effects */
    --frost-blur:           8px;
}

/* Light Mode Override */
[data-theme="light"] {
    --bg-primary:           #FFFFFF;
    --bg-secondary:         #F5F7FA;
    --bg-tertiary:          #E9ECEF;
    --text-primary:         #1A1A1A;
    --text-secondary:       #4A5568;
    --text-muted:           #718096;
    --border-color:         #CBD5E0;
    --border-light:         #E2E8F0;
    --accent-color:         #0D6EFD;
    --accent-hover:         #0B5ED7;
    --success-color:        #16A34A;
    --warning-color:        #F59E0B;
    --danger-color:         #DC3545;
    --error-color:          #DC3545;
    --info-color:           #0EA5E9;
    
    /* Glass Morphism Effects for Light Mode */
    --glass-bg:             rgba(255, 255, 255, 0.8);
    --glass-border:         rgba(0, 0, 0, 0.1);
    --glass-divider:        rgba(0, 0, 0, 0.08);
    
    /* Shadows for Light Mode */
    --shadow:               rgba(0, 0, 0, 0.08);
    --shadow-hover:         rgba(0, 0, 0, 0.12);
    --card-shadow:          0 2px 8px rgba(0, 0, 0, 0.08);
    --section-shadow:       0 2px 12px rgba(0, 0, 0, 0.1);
    --section-glow:         0 4px 16px rgba(13, 110, 253, 0.12);
}

/* Zelda Realm Map Styles - Dark Mode Default */
body {
    background-color: var(--bg-primary) !important;
    margin: 0;
    padding: 0;
    font-family: 'Cinzel', serif;
}

html {
    background-color: var(--bg-primary) !important;
}

/* Leaflet map container background - Using BOTW Colors */
.leaflet-container {
    background-color: var(--bg-primary) !important;
    /* Optimized for performance */
    will-change: transform;
    transform: translateZ(0); /* Force hardware acceleration */
    backface-visibility: hidden;
    perspective: 1000px;
}


.leaflet-control-zoom a {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%) !important;
    border: 1px solid var(--botw-blue) !important;
    color: var(--botw-blue) !important;
}

.leaflet-control-zoom a:hover {
    background: var(--botw-blue) !important;
    color: var(--bg-primary) !important;
}

.leaflet-tile-container {
    background-color: var(--bg-primary) !important;
}

.leaflet-map-pane {
    background-color: var(--bg-primary) !important;
}

#map {
    width: 100%;
    height: 100vh;
    position: relative;
}

/* Loading Screen Overlay */
.map-loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1a2e 50%, var(--bg-primary) 100%);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    transition: opacity 0.5s ease-out;
    overflow: hidden;
}

.map-loading-overlay::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23D4AF37" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
    opacity: 0.1;
    animation: gridMove 20s linear infinite;
}

@keyframes gridMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(10px, 10px); }
}

.map-loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

/* Loading Spinner */
.map-loading-spinner {
    width: 80px;
    height: 80px;
    border: 6px solid rgba(212, 175, 55, 0.2);
    border-top: 6px solid var(--botw-blue);
    border-right: 6px solid #D4AF37;
    border-radius: 50%;
    animation: spin 1.5s linear infinite;
    margin-bottom: 30px;
    position: relative;
    box-shadow: 0 0 20px rgba(0, 150, 255, 0.3);
}

.map-loading-spinner::before {
    content: '';
    position: absolute;
    top: -6px;
    left: -6px;
    right: -6px;
    bottom: -6px;
    border: 2px solid transparent;
    border-top: 2px solid #D4AF37;
    border-radius: 50%;
    animation: spin 2s linear infinite reverse;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Loading Text */
.map-loading-text {
    color: var(--botw-blue);
    font-family: 'Cinzel', serif;
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
}

.map-loading-subtitle {
    color: var(--text-secondary);
    font-family: 'Cinzel', serif;
    font-size: 14px;
    text-align: center;
    margin-top: 10px;
    font-style: italic;
}

/* Loading Progress Bar */
.loading-progress-container {
    margin-top: 20px;
    width: 300px;
    margin-left: auto;
    margin-right: auto;
}

.loading-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(212, 175, 55, 0.2);
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid rgba(212, 175, 55, 0.3);
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
}

.loading-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--botw-blue) 0%, #D4AF37 100%);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 3px;
    box-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
}

.loading-progress-text {
    color: var(--botw-blue);
    font-family: 'Cinzel', serif;
    font-size: 12px;
    text-align: center;
    margin-top: 8px;
    font-weight: 600;
}

/* Zelda square label styling - Using BOTW Colors */
.zelda-label {
    background: transparent !important;
    border: none !important;
    overflow: hidden !important;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.9), 0 0 8px rgba(0,163,218,0.5);
    opacity: 1 !important;
    z-index: 3000 !important; /* Above everything including grid lines */
}

/* Clear label when square is loaded */
.zelda-label.loaded {
    opacity: 1 !important;
}

.zelda-label div {
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-family: 'Cinzel', serif;
    color: var(--botw-blue);
    font-weight: bold;
}

/* Legacy square-label for backward compatibility */
.square-label {
    background: transparent !important;
    border: none !important;
    overflow: hidden !important;
}

.square-label div {
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Zelda square styling - GRID LAYER */
.zelda-square {
    stroke-linejoin: miter !important;
    stroke-linecap: butt !important;
    filter: drop-shadow(0 0 3px rgba(0,163,218, 0.5)) !important;
    opacity: 1 !important;
    z-index: 1000 !important; /* Above hidden areas, below quadrants */
    /* Performance optimizations */
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
    /* Progressive loading blur effect */
    transition: filter 0.8s ease-out, opacity 0.8s ease-out;
}

/* Loading state - blurry and semi-transparent */
.zelda-square.loading {
    filter: drop-shadow(0 0 3px rgba(0,163,218, 0.5)) blur(6px) !important;
    opacity: 0.6 !important;
    transition: filter 1.2s ease-out, opacity 1.2s ease-out;
}

/* Loading state for map images */
.zelda-square.loading .map-image {
    filter: blur(10px) !important;
    opacity: 0.7 !important;
    transition: filter 1.5s ease-out, opacity 1.5s ease-out;
}

/* Clear blur when square is fully loaded */
.zelda-square.loaded {
    filter: drop-shadow(0 0 3px rgba(0,163,218, 0.5)) !important;
    opacity: 1 !important;
    transition: filter 0.6s ease-out, opacity 0.6s ease-out;
}

/* Loaded state for map images */
.zelda-square.loaded .map-image {
    filter: blur(0px) !important;
    opacity: 1 !important;
    transition: filter 0.8s ease-out, opacity 0.8s ease-out;
}

/* Map background styling - LOWEST LAYER */
.map-background {
    z-index: 0 !important; /* Background layer - lowest priority */
}

/* Map image styling - BASE LAYER */
.map-image {
    filter: none !important;
    opacity: 1 !important;
    z-index: 1 !important; /* Base layer - lowest priority */
    /* Performance optimizations */
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
    image-rendering: optimizeSpeed;
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-crisp-edges;
    image-rendering: crisp-edges;
}

/* Clear blur when map image is loaded */
.map-image.loaded {
    filter: none !important;
    opacity: 1 !important;
    transition: opacity 0.2s ease-in-out;
}

/* Hidden areas layer styling - MIDDLE LAYER */
.layer-hidden {
    filter: none !important;
    opacity: 1 !important;
    z-index: 100 !important; /* Above base map, below markers */
}

.layer-hidden.loaded {
    filter: none !important;
    opacity: 1 !important;
}

/* Markers layer styling - MIDDLE LAYER */
.layer-markers {
    filter: none !important;
    opacity: 1 !important;
    z-index: 200 !important; /* Above hidden areas, below grid */
}

.layer-markers.loaded {
    filter: none !important;
    opacity: 1 !important;
}

/* Village bounds layer styling */
.layer-village-bounds {
    filter: none !important;
    opacity: 1 !important;
    z-index: 150 !important; /* Above hidden areas, below markers */
}

.layer-village-bounds.loaded {
    filter: none !important;
    opacity: 1 !important;
}

/* Regions names layer styling */
.layer-regions-names {
    filter: none !important;
    opacity: 1 !important;
    z-index: 175 !important; /* Above village bounds, below markers */
}

.layer-regions-names.loaded {
    filter: none !important;
    opacity: 1 !important;
}

/* Region borders layer styling */
.layer-region-borders {
    filter: none !important;
    opacity: 1 !important;
    z-index: 125 !important; /* Above village bounds, below regions names */
}

.layer-region-borders.loaded {
    filter: none !important;
    opacity: 1 !important;
}

/* Paths/roads layer styling */
.layer-paths-roads {
    filter: none !important;
    opacity: 1 !important;
    z-index: 100 !important; /* Above hidden areas, below region borders */
}

.layer-paths-roads.loaded {
    filter: none !important;
    opacity: 1 !important;
}


/* Quadrant border styling - TOP GRID LAYER */
.quadrant-border {
    filter: drop-shadow(0 0 2px rgba(212, 175, 55, 0.6)) !important;
    z-index: 2000 !important; /* Above everything - top layer */
}

.quadrant-border:hover {
    filter: drop-shadow(0 0 4px rgba(212, 175, 55, 0.8)) !important;
}

/* Removed shimmer effect to prevent loading issues */

/* Legacy seamless square styling */
.seamless-square {
    stroke-linejoin: miter !important;
    stroke-linecap: butt !important;
}

/* Quadrant styling */
.quadrant-border {
    stroke-dasharray: 2,2 !important;
    opacity: 0.6 !important;
}

.quadrant-label {
    background: transparent !important;
    border: none !important;
    overflow: hidden !important;
    pointer-events: none !important;
    z-index: 3000 !important; /* Above everything including grid lines */
}

.quadrant-label div {
    max-width: 30px !important;
    max-height: 15px !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    line-height: 1 !important;
    padding: 0 !important;
    margin: 0 !important;
    display: inline-block !important;
    box-sizing: border-box !important;
}

/* Hide quadrant labels when zoomed out */
.quadrant-label[style*="opacity: 0"],
.quadrant-label[style*="display: none"] {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

/* Zelda Realm Sidebar styles - Using BOTW Colors */
.side-ui {
    position: fixed;
    top: 0;
    right: 0;
    width: 300px;
    height: 100vh;
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    border-left: 3px solid var(--botw-blue);
    box-shadow: -5px 0 15px rgba(0,0,0,0.5);
    z-index: 1000;
    transform: translateX(0);
}

.side-ui.collapsed {
    transform: translateX(250px);
}

.ui-content {
    padding: 20px;
    color: var(--text-primary);
    font-family: 'Cinzel', serif;
}

.ui-header h2 {
    margin: 0 0 10px 0;
    color: var(--botw-blue);
    font-family: 'Cinzel', serif;
    font-weight: 600;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
}

.ui-header p {
    color: var(--text-secondary);
    font-style: italic;
}

.close-btn {
    background: none;
    border: 2px solid var(--botw-blue);
    color: var(--botw-blue);
    font-size: 18px;
    cursor: pointer;
    float: right;
    padding: 5px 10px;
    border-radius: 5px;
}

.close-btn:hover {
    color: var(--botw-dark-blue);
    border-color: var(--botw-dark-blue);
    background: rgba(0,163,218, 0.2);
}

/* Zelda UI Toggle Button */
.ui-toggle {
    position: absolute;
    left: -40px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    border: 2px solid var(--botw-blue);
    color: var(--botw-blue);
    width: 40px;
    height: 60px;
    cursor: pointer;
    border-radius: 8px 0 0 8px;
    box-shadow: -2px 0 8px rgba(0,0,0,0.3);
}

.ui-toggle:hover {
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--botw-dark-blue);
    border-color: var(--botw-dark-blue);
}

/* Performance Metrics Display */
.performance-metrics {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--frost-blur));
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    padding: 12px;
    font-family: 'Cinzel', serif;
    font-size: 12px;
    color: var(--text-primary);
    z-index: 1000;
    min-width: 200px;
    box-shadow: var(--card-shadow);
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.performance-metrics:hover {
    opacity: 1;
}

.performance-metrics div {
    margin: 2px 0;
    display: flex;
    justify-content: space-between;
}

.performance-metrics .metric-label {
    color: var(--text-secondary);
    font-weight: 400;
}

.performance-metrics .metric-value {
    color: var(--botw-blue);
    font-weight: 600;
}

/* Performance indicator colors */
.performance-metrics .good {
    color: var(--success-color);
}

.performance-metrics .warning {
    color: var(--warning-color);
}

.performance-metrics .critical {
    color: var(--danger-color);
}